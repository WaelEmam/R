
# Loading required libraries
library(dplyr)
library(anytime)
library(lubridate)
library(prophet)
library(rmarkdown)

# Data Filtering & manipulation
files_used <- mutate(files, RawSize = (((FileSize/1024)/1024)/1024) * Replication, MTime = anytime(ModificationTime)) %>%
  select (RawSize, MTime) %>%
  group_by(day=floor_date(MTime, "day")) %>%
  filter (day > '2017-04-01') %>%
  summarize(RawSize = sum(RawSize))
  
# Change column names for prophet to work
names(files_used)[1] <- "ds"
names(files_used)[2] <- "y"

# Prophet
m <- prophet(files_used, yearly.seasonality=TRUE)

# Prediction
future <- make_future_dataframe(m, periods = 365)
forcast <- predict (m, future)

# Plot
plot(m, forcast)
prophet_plot_components(m, forcast)

# Percentage of HDFS files accessed in the last 30 days
files_used_access <- fsimage %>%
  filter(FileSize > 0) %>%
  select (FileSize, Path, ModificationTime)
x =  nrow(files_used_access)
files_access <- mutate(files_used_access, MTime = anytime(ModificationTime)) %>%
  select (Path, MTime) %>%
  filter(MTime > today() - days(30))
y = nrow(files_access)
z = (y / x) * 100


Percentage of files accessed in the last 30 days `r ceiling(z)`%
